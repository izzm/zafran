<% content_for :page_javascript do %>
  $(document).ready(function() {
    $('#cart_link').click(function() {
      $('#cart_form').submit();
      return false;
    });

    $("#order_address").keypress(function() {
      $("#order_delivery_type_delivery").
        attr('checked', 'checked').
        prev().css('background-position', '0px -50px');
    });
  
    $("#switch_delivery_to_russia").click(function(){
      $("#moscow_delivery").hide();
      $("#russia_delivery").show();
    
      return false;
    });
  
    $("#switch_delivery_to_moscow").click(function(){
      $("#russia_delivery").hide();
      $("#moscow_delivery").show();
    
      return false;
    }).click();
    
    $(".inactive_btn").click(function(){
      return false;
    });
  });
<% end %>

<div class="cart_item">
	<h3>Ваша корзина</h3>
	<%= form_tag cart_recalculate_path, :method => :post, :id => 'cart_form' do %>
    <ul>
      <li class="cart_title">
        <div class="photo_block">Фото</div>
        <span class="title_product">Название</span>
        <span class="weight_product">Вес</span>
        <span class="price_cart">Цена, руб.</span>
        <span class="quantity_product">Кол-во</span>
        <span class="delete_product">Удалить</span>
      </li>
      
      <% @goods.each do |good| -%>
        <li>
          <div class="photo_block">
            <table>
              <tr>
                <td>
                  <% attachment = good.category.attachments.main.first || 
                                  good.category.attachments.first -%>
                  <% category_image_path = attachment.try(:image).try(:url, :small) || "site/small_photo3.jpg" -%>
                  <%= link_to image_tag(category_image_path), category_path(:path => good.category.url_path) %>
                </td>
              </tr>
            </table>
          </div>
          <span class="title_product">
            <%= link_to good.category.name, category_path(:path => good.category.url_path) %>
          </span>
          <span class="weight_product"><%= good.name %></span>
          <span class="price_cart"><%= number_to_currency(good.price) %></span>
          <span class="quantity_product">
            <%= text_field_tag "counts[#{good.id}]", session[:cart][good.id][:count], :class => "standart_inptxt" %>
          </span>
          <span class="delete_product">
            <%= link_to "", cart_remove_good_path(:good_id => good.id), :method => :post %>
          </span>
        </li>
      <% end -%>
      
      <div class="intotal">
      	<p>
      	  <b>Итого:</b>
      	  <span class="priority1"><%= session[:cart_weight] %> грамм</span> на сумму <span class="priority1"><%= number_to_currency(session[:cart_price]) %></span>
      	</p>
        <p>
          <b>Доставка:</b> <span class="priority1">бесплатно</span>
        </p>
        <p>
          <span class="priority1"><%= link_to "Пересчитать", "#", :id => 'cart_link' if @goods.count > 0 %></span>
        </p>
      </div>
    </ul>
  <% end %>
</div><!--.cart_item-->

<div class="delivery" id="russia_delivery">
	<h3>Доставка</h3>
    <form action="">
      <div class="select_region"><a href="#" class="violet_btn btn_big" id="switch_delivery_to_moscow">По Москве</a><a href="#" class="red_btn btn_big inactive_btn">По России</a></div>
      
    <p>Доставка осуществляется наложенным платежом почтой России, оплата при получени на почте. Примерный срок доставки 3-10 дней в зависимости от дальности региона. Для оформления заказа заполните приведенную ниже форму.</p>
    <div class="contact_info">
	<h3>Контактная информация</h3>
    	<p><label>ФИО получателя<span>*</span></label><br /><input type="text" name="" value="Иванов Иван Иванович" class="standart_inptxt" onclick="if(this.value=='Иванов Иван Иванович'){this.value='';}" onblur="if(this.value==''){this.value='Иванов Иван Иванович';}" onkeydown="setcolor(this,'#000')"/></p>
        <p><label>Телефон</label><br /><input type="text" name="" value="+7 (495) 549-09-95" class="standart_inptxt" onclick="if(this.value=='+7 (495) 549-09-95'){this.value='';}" onblur="if(this.value==''){this.value='+7 (495) 549-09-95';}" onkeydown="setcolor(this,'#000')"/></p>
        <p><label>Email<span>*</span></label><br /><input type="text" name="" value="name@example.ru" class="standart_inptxt" onclick="if(this.value=='name@example.ru'){this.value='';}" onblur="if(this.value==''){this.value='name@example.ru';}" onkeydown="setcolor(this,'#000')"/></p>
        <span class="info_txt"><span>*</span>Поля отмеченные звездочкой, обязательны для заполнения.</span>
    </div>
    <fieldset>	
    <div class="adress">
    	<h3>Адрес</h3>
    	<ul>
        	<li><label>Индекс</label><br /><input type="text" class="standart_inptxt" /></li>
            <li><label>Населенный пункт</label><br /><input type="text" class="standart_inptxt" /></li>
            <li><label>Область</label><br /><input type="text" class="standart_inptxt" /></li>
            <li><label>Улица</label><br /><input type="text" class="standart_inptxt grid5" /></li>
            <li><label>Дом</label><br /><input type="text" class="standart_inptxt grid1" /></li>
            <li><label>Корпус</label><br /><input type="text" class="standart_inptxt grid1" /></li>
            <li><label>Строение</label><br /><input type="text" class="standart_inptxt grid1" /></li>
            <li><label>Квартира</label><br /><input type="text" class="standart_inptxt grid1" /></li>
        </ul>
    </div>
    </fieldset>
    <fieldset>
    	<div class="comment">
    		<h3>Комментарий</h3>
            <textarea rows="" cols=""></textarea><input type="submit" value="Отправить" class="violet_submit" />
        </div>
    </fieldset>
    </form>
</div><!--.delivery-->


<div class="delivery" id="moscow_delivery">
	<h3>Доставка</h3>
    <form action="">
      <div class="select_region"><a href="#" class="red_btn btn_big inactive_btn">По Москве</a><a href="#" class="violet_btn btn_big" id="switch_delivery_to_russia">По России</a></div>


    <p>Доставка осуществляется в пределах МКАД. Для оформления заказа заполните приведенную ниже форму.</p>
    <div class="contact_info">
	<h3>Контактная информация</h3>
    	<p><label>ФИО получателя<span>*</span></label><br /><input type="text" name="" value="Иванов Иван Иванович" class="standart_inptxt" onclick="if(this.value=='Иванов Иван Иванович'){this.value='';}" onblur="if(this.value==''){this.value='Иванов Иван Иванович';}" onkeydown="setcolor(this,'#000')"/></p>
        <p><label>Телефон</label><br /><input type="text" name="" value="+7 (495) 549-09-95" class="standart_inptxt" onclick="if(this.value=='+7 (495) 549-09-95'){this.value='';}" onblur="if(this.value==''){this.value='+7 (495) 549-09-95';}" onkeydown="setcolor(this,'#000')"/></p>
        <p><label>Email<span>*</span></label><br /><input type="text" name="" value="name@example.ru" class="standart_inptxt" onclick="if(this.value=='name@example.ru'){this.value='';}" onblur="if(this.value==''){this.value='name@example.ru';}" onkeydown="setcolor(this,'#000')"/></p>
        <span class="info_txt"><span>*</span>Поля отмеченные звездочкой, обязательны для заполнения.</span>
    </div>
    <fieldset>	
    <div class="adress">
    	<h3>Адрес</h3>
    	<ul>
            <li><label>Улица</label><br /><input type="text" class="standart_inptxt grid5" /></li>
            <li><label>Дом</label><br /><input type="text" class="standart_inptxt grid1" /></li>
            <li><label>Корпус</label><br /><input type="text" class="standart_inptxt grid1" /></li>
            <li><label>Строение</label><br /><input type="text" class="standart_inptxt grid1" /></li>
            <li><label>Квартира</label><br /><input type="text" class="standart_inptxt grid1" /></li>
        </ul>
    </div>
    </fieldset>
    <fieldset>
    	<div class="comment">
    		<h3>Комментарий</h3>
            <textarea rows="" cols=""></textarea><input type="submit" value="Отправить" class="violet_submit" />
        </div>
    </fieldset>
    </form>
</div><!--.delivery-->

<% pickup_page = StaticPage.find_by_url_path('settings/pickup') -%>
<% if !pickup_page.nil? && pickup_page.visible -%>
  <div class="pickup">
    <h3>Самовывоз</h3>
    Вы можете забрать свой заказ по следующим адреса:
    <%=raw pickup_page.try(:content) %><br />
    <p class="link_block"><a href="#" class="violet_btn btn_big">Отправить</a></p>
  </div>
<% end -%>

<% if false -%>

<div class="my_cart">
  <h2>Мои заказы</h2>
  <%= form_tag cart_recalculate_path, :method => :post, :id => 'cart_form' do %>
    <ul>
      <li class="cart_title">
        <span class="title_prod">Название</span>
        <span class="articul_prod">Артикул</span>
        <span class="photo_prod">Фото</span>
        <span class="price_prod">Цена</span>
        <span class="quantity_prod">Кол-во</span>
        <span class="delet_prod">Удалить</span>
      </li>
      
      <% @goods.each do |good| -%>
      <li>
        <div class="border">
          <span class="title_prod">
            <%= link_to good.name, good_path(:path => good.category.url_path, :id => good.id) %><br>
            <span class="variant">
              <%=raw (session[:cart][good.id][:variant] || {}).map{ |variant_type, variant|
                content_tag :nobr, "#{t("good.variants.#{variant_type}")}: #{variant}"
              }.join(", ") -%>
            </span>
          </span>
          <span class="articul_prod"><%= good.articul %></span>
          <span class="photo_prod"><%= link_to image_tag(good.attachments.first.image.url(:cart)), good_path(:path => good.category.url_path, :id => good.id) %></span>
          <span class="price_prod"><%= number_to_currency(good.price) %></span>
          <span class="quantity_prod">
            <%= text_field_tag "counts[#{good.id}]", session[:cart][good.id][:count] %>
          </span>
          <span class="delet_prod">
            <%= link_to image_tag("site/cart_prod_delet.png"), cart_remove_good_path(:good_id => good.id), :method => :post %>
          </span>
        </div>
      </li>
      <% end -%>
      
      <li class="intotal">
        <%= link_to "Пересчитать", "#", :id => 'cart_link' if @goods.count > 0 %>Итого: <span class="intotal_price"><%= number_to_currency(session[:cart_price]) %></span>
      </li>
    </ul>
  <% end %>
 
  <% if @goods.count > 0 -%>
  <div class="delivery">
    <h5>Доставка</h5>
    
    <%= form_tag cart_purchase_path, :id => "purchase_form", :method => :post do %>
      <p>
        <%= radio_button 'order', 'delivery_type', 'delivery', :class => 'styled' %>
        <%= label 'order', 'delivery_type_delivery', 'Доставка'  %>
      </p>
      <p>
        <%= label 'order', 'address', 'по адресу:' %><br />
        <%= text_field 'order', 'address', :class => 'text_inp19px' %>
      </p>
      
      <p class="cent_rad">
        <%= radio_button 'order', 'delivery_type', 'manual', :class => 'styled' %>
        <%= label 'order', 'delivery_type_manual', 'Самовывоз'  %>
      </p>

      <p>
        <label><strong>Добавить комментарий</strong></label><br />
        <%= text_area 'order', 'comment' %>
        <input type="submit" value="Оформить заказ" class="blue_inp_bg" />
      </p>
    <% end %>
  </div>
  <% end -%>
</div><!--end_my_cart-->
<% end -%>
